{% extends "base_generic.html" %}

{% block content %}
  <h2>Edit Visit</h2>
  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Save</button>
  </form>

  <script>
    function roundTimeToNearestQuarterHour(timeString) {
        let [hours, minutes] = timeString.split(':').map(Number);
        minutes = Math.round(minutes / 15) * 15;
        if (minutes === 60) {
            minutes = 0;
            hours = (hours + 1) % 24;
        }
        return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const timeInputs = document.querySelectorAll('input[type="time"]');
        timeInputs.forEach(function(input) {
            input.addEventListener('blur', function(event) {
                const roundedTime = roundTimeToNearestQuarterHour(event.target.value);
                event.target.value = roundedTime;
            });
        });
    });
  </script>
{% endblock %}
